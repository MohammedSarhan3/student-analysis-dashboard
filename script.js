// بيانات التحليل الكاملة

// بيانات الصف الثالث الابتدائي
const thirdGrade = {"totalStudents":38,"subjects":{"اللغة العربية":{"studentCount":37,"totalMarks":60,"averageScore":54.16,"averagePercentage":90.3,"maxScore":60.0,"minScore":38.0,"distribution":{"below50":0,"from50to65":1,"from65to75":4,"from75to85":4,"from85to100":28,"below50Percentage":0.0,"from50to65Percentage":2.7027027027027026,"from65to75Percentage":10.81081081081081,"from75to85Percentage":10.81081081081081,"from85to100Percentage":75.67567567567568}},"الرياضيات":{"studentCount":37,"totalMarks":60,"averageScore":55.08,"averagePercentage":91.8,"maxScore":60.0,"minScore":40.0,"distribution":{"below50":0,"from50to65":0,"from65to75":5,"from75to85":5,"from85to100":27,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":13.513513513513514,"from75to85Percentage":13.513513513513514,"from85to100Percentage":72.97297297297297}},"اللغة الإنجليزية - CONNECT":{"studentCount":37,"totalMarks":60,"averageScore":56.7,"averagePercentage":94.5,"maxScore":60.0,"minScore":20.0,"distribution":{"below50":1,"from50to65":0,"from65to75":0,"from75to85":3,"from85to100":33,"below50Percentage":2.7027027027027026,"from50to65Percentage":0.0,"from65to75Percentage":0.0,"from75to85Percentage":8.108108108108109,"from85to100Percentage":89.1891891891892}},"التربية الدينية":{"studentCount":37,"totalMarks":60,"averageScore":49.62,"averagePercentage":82.7,"maxScore":60.0,"minScore":38.0,"distribution":{"below50":0,"from50to65":1,"from65to75":9,"from75to85":9,"from85to100":18,"below50Percentage":0.0,"from50to65Percentage":2.7027027027027026,"from65to75Percentage":24.324324324324326,"from75to85Percentage":24.324324324324326,"from85to100Percentage":48.64864864864865}},"CONNECT PLUS (اللغات)":{"studentCount":18,"totalMarks":60,"averageScore":58.33,"averagePercentage":97.2,"maxScore":60.0,"minScore":48.0,"distribution":{"below50":0,"from50to65":0,"from65to75":0,"from75to85":1,"from85to100":17,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":0.0,"from75to85Percentage":5.555555555555555,"from85to100Percentage":94.44444444444444}}},"averageOverall":91.3};

// بيانات الصف الرابع الابتدائي
const fourthGrade = {"totalStudents":59,"subjects":{"اللغة العربية":{"studentCount":58,"totalMarks":60,"averageScore":48.93,"averagePercentage":81.6,"maxScore":60.0,"minScore":32.0,"distribution":{"below50":0,"from50to65":10,"from65to75":10,"from75to85":11,"from85to100":27,"below50Percentage":0.0,"from50to65Percentage":17.24137931034483,"from65to75Percentage":17.24137931034483,"from75to85Percentage":18.96551724137931,"from85to100Percentage":46.55172413793103}},"الرياضيات":{"studentCount":58,"totalMarks":60,"averageScore":51.91,"averagePercentage":86.5,"maxScore":60.0,"minScore":26.0,"distribution":{"below50":1,"from50to65":4,"from65to75":4,"from75to85":14,"from85to100":35,"below50Percentage":1.7241379310344827,"from50to65Percentage":6.896551724137931,"from65to75Percentage":6.896551724137931,"from75to85Percentage":24.137931034482758,"from85to100Percentage":60.3448275862069}},"اللغة الإنجليزية - CONNECT":{"studentCount":58,"totalMarks":60,"averageScore":54.34,"averagePercentage":90.6,"maxScore":60.0,"minScore":40.0,"distribution":{"below50":0,"from50to65":0,"from65to75":7,"from75to85":6,"from85to100":45,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":12.068965517241379,"from75to85Percentage":10.344827586206897,"from85to100Percentage":77.58620689655173}},"العلوم":{"studentCount":58,"totalMarks":60,"averageScore":55.12,"averagePercentage":91.9,"maxScore":60.0,"minScore":36.0,"distribution":{"below50":0,"from50to65":1,"from65to75":3,"from75to85":5,"from85to100":49,"below50Percentage":0.0,"from50to65Percentage":1.7241379310344827,"from65to75Percentage":5.172413793103448,"from75to85Percentage":8.620689655172415,"from85to100Percentage":84.48275862068965}},"الدراسات الاجتماعية":{"studentCount":58,"totalMarks":60,"averageScore":46.55,"averagePercentage":77.6,"maxScore":60.0,"minScore":24.0,"distribution":{"below50":6,"from50to65":11,"from65to75":7,"from75to85":9,"from85to100":25,"below50Percentage":10.344827586206897,"from50to65Percentage":18.96551724137931,"from65to75Percentage":12.068965517241379,"from75to85Percentage":15.517241379310345,"from85to100Percentage":43.103448275862064}},"التربية الدينية":{"studentCount":58,"totalMarks":60,"averageScore":39.69,"averagePercentage":66.1,"maxScore":60.0,"minScore":16.0,"distribution":{"below50":12,"from50to65":17,"from65to75":5,"from75to85":9,"from85to100":15,"below50Percentage":20.689655172413794,"from50to65Percentage":29.310344827586203,"from65to75Percentage":8.620689655172415,"from75to85Percentage":15.517241379310345,"from85to100Percentage":25.862068965517242}},"تكنولوجيا المعلومات والإتصال":{"studentCount":58,"totalMarks":60,"averageScore":52.98,"averagePercentage":88.3,"maxScore":60.0,"minScore":39.0,"distribution":{"below50":0,"from50to65":0,"from65to75":6,"from75to85":12,"from85to100":40,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":10.344827586206897,"from75to85Percentage":20.689655172413794,"from85to100Percentage":68.96551724137932}},"المستوى الرفيع (مدارس اللغات)":{"studentCount":11,"totalMarks":60,"averageScore":54.18,"averagePercentage":90.3,"maxScore":60.0,"minScore":45.0,"distribution":{"below50":0,"from50to65":0,"from65to75":0,"from75to85":3,"from85to100":8,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":0.0,"from75to85Percentage":27.27272727272727,"from85to100Percentage":72.72727272727273}},"اللغة الفرنسية (قسم اللغات)":{"studentCount":11,"totalMarks":60,"averageScore":56.18,"averagePercentage":93.6,"maxScore":60.0,"minScore":50.0,"distribution":{"below50":0,"from50to65":0,"from65to75":0,"from75to85":1,"from85to100":10,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":0.0,"from75to85Percentage":9.090909090909092,"from85to100Percentage":90.9090909090909}}},"averageOverall":85.2};

// بيانات الصف الخامس الابتدائي
const fifthGrade = {"totalStudents":47,"subjects":{"اللغة العربية":{"studentCount":47,"totalMarks":60,"averageScore":51.85,"averagePercentage":86.4,"maxScore":60.0,"minScore":35.0,"distribution":{"below50":0,"from50to65":2,"from65to75":3,"from75to85":13,"from85to100":29,"below50Percentage":0.0,"from50to65Percentage":4.25531914893617,"from65to75Percentage":6.382978723404255,"from75to85Percentage":27.659574468085108,"from85to100Percentage":61.702127659574465}},"الرياضيات":{"studentCount":47,"totalMarks":60,"averageScore":52.04,"averagePercentage":86.7,"maxScore":60.0,"minScore":36.0,"distribution":{"below50":0,"from50to65":3,"from65to75":5,"from75to85":8,"from85to100":31,"below50Percentage":0.0,"from50to65Percentage":6.382978723404255,"from65to75Percentage":10.638297872340425,"from75to85Percentage":17.02127659574468,"from85to100Percentage":65.95744680851064}},"اللغة الإنجليزية - CONNECT":{"studentCount":47,"totalMarks":60,"averageScore":54.72,"averagePercentage":91.2,"maxScore":60.0,"minScore":44.0,"distribution":{"below50":0,"from50to65":0,"from65to75":2,"from75to85":9,"from85to100":36,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":4.25531914893617,"from75to85Percentage":19.148936170212767,"from85to100Percentage":76.59574468085107}},"العلوم":{"studentCount":47,"totalMarks":60,"averageScore":54.26,"averagePercentage":90.4,"maxScore":60.0,"minScore":39.0,"distribution":{"below50":0,"from50to65":0,"from65to75":3,"from75to85":10,"from85to100":34,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":6.382978723404255,"from75to85Percentage":21.27659574468085,"from85to100Percentage":72.3404255319149}},"الدراسات الاجتماعية":{"studentCount":47,"totalMarks":60,"averageScore":48.77,"averagePercentage":81.3,"maxScore":60.0,"minScore":30.0,"distribution":{"below50":0,"from50to65":11,"from65to75":5,"from75to85":5,"from85to100":26,"below50Percentage":0.0,"from50to65Percentage":23.404255319148938,"from65to75Percentage":10.638297872340425,"from75to85Percentage":10.638297872340425,"from85to100Percentage":55.319148936170215}},"تكنولوجيا المعلومات والإتصال":{"studentCount":47,"totalMarks":60,"averageScore":52.36,"averagePercentage":87.3,"maxScore":60.0,"minScore":40.0,"distribution":{"below50":0,"from50to65":0,"from65to75":4,"from75to85":12,"from85to100":31,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":8.51063829787234,"from75to85Percentage":25.53191489361702,"from85to100Percentage":65.95744680851064}},"التربية الدينية":{"studentCount":47,"totalMarks":60,"averageScore":47.32,"averagePercentage":78.9,"maxScore":60.0,"minScore":30.0,"distribution":{"below50":0,"from50to65":12,"from65to75":7,"from75to85":9,"from85to100":19,"below50Percentage":0.0,"from50to65Percentage":25.53191489361702,"from65to75Percentage":14.893617021276595,"from75to85Percentage":19.148936170212767,"from85to100Percentage":40.42553191489361}},"المستوى الرفيع 1 (مدارس اللغات)":{"studentCount":3,"totalMarks":60,"averageScore":57.33,"averagePercentage":95.6,"maxScore":60.0,"minScore":56.0,"distribution":{"below50":0,"from50to65":0,"from65to75":0,"from75to85":0,"from85to100":3,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":0.0,"from75to85Percentage":0.0,"from85to100Percentage":100.0}},"المستوى الرفيع 2 (مدارس اللغات)":{"studentCount":3,"totalMarks":60,"averageScore":54.0,"averagePercentage":90.0,"maxScore":57.0,"minScore":51.0,"distribution":{"below50":0,"from50to65":0,"from65to75":0,"from75to85":0,"from85to100":3,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":0.0,"from75to85Percentage":0.0,"from85to100Percentage":100.0}}},"averageOverall":87.5};

// بيانات الصف السادس الابتدائي
const sixthGrade = {"totalStudents":42,"subjects":{"اللغة العربية":{"studentCount":41,"totalMarks":60,"averageScore":52.05,"averagePercentage":86.7,"maxScore":60.0,"minScore":38.0,"distribution":{"below50":0,"from50to65":2,"from65to75":1,"from75to85":15,"from85to100":23,"below50Percentage":0.0,"from50to65Percentage":4.878048780487805,"from65to75Percentage":2.4390243902439024,"from75to85Percentage":36.58536585365854,"from85to100Percentage":56.09756097560976}},"الرياضيات":{"studentCount":41,"totalMarks":60,"averageScore":49.85,"averagePercentage":83.1,"maxScore":60.0,"minScore":30.0,"distribution":{"below50":0,"from50to65":6,"from65to75":5,"from75to85":6,"from85to100":24,"below50Percentage":0.0,"from50to65Percentage":14.634146341463413,"from65to75Percentage":12.195121951219512,"from75to85Percentage":14.634146341463413,"from85to100Percentage":58.536585365853654}},"اللغة الإنجليزية - CONNECT":{"studentCount":41,"totalMarks":60,"averageScore":55.07,"averagePercentage":91.8,"maxScore":60.0,"minScore":44.0,"distribution":{"below50":0,"from50to65":0,"from65to75":1,"from75to85":5,"from85to100":35,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":2.4390243902439024,"from75to85Percentage":12.195121951219512,"from85to100Percentage":85.36585365853658}},"العلوم":{"studentCount":41,"totalMarks":60,"averageScore":51.8,"averagePercentage":86.3,"maxScore":60.0,"minScore":36.0,"distribution":{"below50":0,"from50to65":3,"from65to75":7,"from75to85":4,"from85to100":27,"below50Percentage":0.0,"from50to65Percentage":7.317073170731707,"from65to75Percentage":17.073170731707318,"from75to85Percentage":9.75609756097561,"from85to100Percentage":65.85365853658537}},"الدراسات الاجتماعية":{"studentCount":41,"totalMarks":60,"averageScore":48.1,"averagePercentage":80.2,"maxScore":60.0,"minScore":24.0,"distribution":{"below50":2,"from50to65":6,"from65to75":7,"from75to85":5,"from85to100":21,"below50Percentage":4.878048780487805,"from50to65Percentage":14.634146341463413,"from65to75Percentage":17.073170731707318,"from75to85Percentage":12.195121951219512,"from85to100Percentage":51.21951219512195}},"تكنولوجيا المعلومات والإتصال":{"studentCount":41,"totalMarks":60,"averageScore":55.8,"averagePercentage":93.0,"maxScore":60.0,"minScore":48.0,"distribution":{"below50":0,"from50to65":0,"from65to75":0,"from75to85":4,"from85to100":37,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":0.0,"from75to85Percentage":9.75609756097561,"from85to100Percentage":90.2439024390244}},"التربية الدينية":{"studentCount":41,"totalMarks":60,"averageScore":44.39,"averagePercentage":74.0,"maxScore":58.0,"minScore":10.0,"distribution":{"below50":11,"from50to65":1,"from65to75":1,"from75to85":5,"from85to100":23,"below50Percentage":26.82926829268293,"from50to65Percentage":2.4390243902439024,"from65to75Percentage":2.4390243902439024,"from75to85Percentage":12.195121951219512,"from85to100Percentage":56.09756097560976}},"المستوى الرفيع 1 (مدارس اللغات)":{"studentCount":7,"totalMarks":60,"averageScore":56.57,"averagePercentage":94.3,"maxScore":60.0,"minScore":47.0,"distribution":{"below50":0,"from50to65":0,"from65to75":0,"from75to85":1,"from85to100":6,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":0.0,"from75to85Percentage":14.285714285714285,"from85to100Percentage":85.71428571428571}},"المستوى الرفيع 2 (مدارس اللغات)":{"studentCount":7,"totalMarks":60,"averageScore":51.0,"averagePercentage":85.0,"maxScore":60.0,"minScore":36.0,"distribution":{"below50":0,"from50to65":1,"from65to75":0,"from75to85":1,"from85to100":5,"below50Percentage":0.0,"from50to65Percentage":14.285714285714285,"from65to75Percentage":0.0,"from75to85Percentage":14.285714285714285,"from85to100Percentage":71.42857142857143}}},"averageOverall":86.0};

// بيانات الصف الأول الإعدادي
const firstPrepGrade = {"totalStudents":66,"subjects":{"اللغة العربية والخط":{"studentCount":66,"totalMarks":30,"averageScore":22.64,"averagePercentage":75.5,"distribution":{"below50":7,"from50to65":6,"from65to75":14,"from75to85":18,"from85to100":21,"below50Percentage":10.6,"from50to65Percentage":9.1,"from65to75Percentage":21.2,"from75to85Percentage":27.3,"from85to100Percentage":31.8}},"اللغة الاجنبية":{"studentCount":66,"totalMarks":30,"averageScore":23.98,"averagePercentage":79.9,"distribution":{"below50":4,"from50to65":8,"from65to75":7,"from75to85":20,"from85to100":27,"below50Percentage":6.1,"from50to65Percentage":12.1,"from65to75Percentage":10.6,"from75to85Percentage":30.3,"from85to100Percentage":40.9}},"الدرسات الاجتماعية":{"studentCount":66,"totalMarks":30,"averageScore":22.53,"averagePercentage":75.1,"distribution":{"below50":6,"from50to65":16,"from65to75":8,"from75to85":11,"from85to100":25,"below50Percentage":9.1,"from50to65Percentage":24.2,"from65to75Percentage":12.1,"from75to85Percentage":16.7,"from85to100Percentage":37.9}},"الرياضيات":{"studentCount":66,"totalMarks":30,"averageScore":23.71,"averagePercentage":79.0,"distribution":{"below50":5,"from50to65":11,"from65to75":8,"from75to85":11,"from85to100":31,"below50Percentage":7.6,"from50to65Percentage":16.7,"from65to75Percentage":12.1,"from75to85Percentage":16.7,"from85to100Percentage":47.0}},"العلوم":{"studentCount":66,"totalMarks":6,"averageScore":5.91,"averagePercentage":98.5,"distribution":{"below50":1,"from50to65":0,"from65to75":0,"from75to85":0,"from85to100":65,"below50Percentage":1.5,"from50to65Percentage":0.0,"from65to75Percentage":0.0,"from75to85Percentage":0.0,"from85to100Percentage":98.5}},"التربية الدينية":{"studentCount":66,"totalMarks":30,"averageScore":20.91,"averagePercentage":69.7,"distribution":{"below50":8,"from50to65":16,"from65to75":17,"from75to85":10,"from85to100":15,"below50Percentage":12.1,"from50to65Percentage":24.2,"from65to75Percentage":25.8,"from75to85Percentage":15.2,"from85to100Percentage":22.7}},"الكمبيوتر وتكنولوجيا المعلومات":{"studentCount":66,"totalMarks":6,"averageScore":6.0,"averagePercentage":100.0,"distribution":{"below50":0,"from50to65":0,"from65to75":0,"from75to85":0,"from85to100":66,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":0.0,"from75to85Percentage":0.0,"from85to100Percentage":100.0}},"المستوي الرفيع 1":{"studentCount":4,"totalMarks":50,"averageScore":47.75,"averagePercentage":95.5,"distribution":{"below50":0,"from50to65":0,"from65to75":0,"from75to85":0,"from85to100":4,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":0.0,"from75to85Percentage":0.0,"from85to100Percentage":100.0}},"المستوي الرفيع 2":{"studentCount":4,"totalMarks":40,"averageScore":36.75,"averagePercentage":91.9,"distribution":{"below50":0,"from50to65":0,"from65to75":0,"from75to85":0,"from85to100":4,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":0.0,"from75to85Percentage":0.0,"from85to100Percentage":100.0}}},"averageOverall":85.0};

// بيانات الصف الثاني الإعدادي
const secondPrepGrade = {"totalStudents":69,"subjects":{"اللغة العربية والخط":{"studentCount":69,"totalMarks":30,"averageScore":25.17,"averagePercentage":83.9,"distribution":{"below50":3,"from50to65":5,"from65to75":10,"from75to85":11,"from85to100":40,"below50Percentage":4.3,"from50to65Percentage":7.2,"from65to75Percentage":14.5,"from75to85Percentage":15.9,"from85to100Percentage":58.0}},"اللغة الاجنبية":{"studentCount":69,"totalMarks":30,"averageScore":26.32,"averagePercentage":87.7,"distribution":{"below50":0,"from50to65":5,"from65to75":5,"from75to85":15,"from85to100":44,"below50Percentage":0.0,"from50to65Percentage":7.2,"from65to75Percentage":7.2,"from75to85Percentage":21.7,"from85to100Percentage":63.8}},"الدرسات الاجتماعية":{"studentCount":69,"totalMarks":30,"averageScore":22.7,"averagePercentage":75.7,"distribution":{"below50":10,"from50to65":14,"from65to75":10,"from75to85":5,"from85to100":30,"below50Percentage":14.5,"from50to65Percentage":20.3,"from65to75Percentage":14.5,"from75to85Percentage":7.2,"from85to100Percentage":43.5}},"الرياضيات":{"studentCount":69,"totalMarks":30,"averageScore":23.28,"averagePercentage":77.6,"distribution":{"below50":3,"from50to65":19,"from65to75":8,"from75to85":10,"from85to100":29,"below50Percentage":4.3,"from50to65Percentage":27.5,"from65to75Percentage":11.6,"from75to85Percentage":14.5,"from85to100Percentage":42.0}},"العلوم":{"studentCount":69,"totalMarks":6,"averageScore":5.91,"averagePercentage":98.6,"distribution":{"below50":1,"from50to65":0,"from65to75":0,"from75to85":0,"from85to100":68,"below50Percentage":1.4,"from50to65Percentage":0.0,"from65to75Percentage":0.0,"from75to85Percentage":0.0,"from85to100Percentage":98.6}},"التربية الدينية":{"studentCount":69,"totalMarks":30,"averageScore":21.93,"averagePercentage":73.1,"distribution":{"below50":4,"from50to65":13,"from65to75":18,"from75to85":19,"from85to100":15,"below50Percentage":5.8,"from50to65Percentage":18.8,"from65to75Percentage":26.1,"from75to85Percentage":27.5,"from85to100Percentage":21.7}},"الكمبيوتر وتكنولوجيا المعلومات":{"studentCount":69,"totalMarks":6,"averageScore":6.0,"averagePercentage":100.0,"distribution":{"below50":0,"from50to65":0,"from65to75":0,"from75to85":0,"from85to100":69,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":0.0,"from75to85Percentage":0.0,"from85to100Percentage":100.0}},"اللغه الاجنبية الاولي المستوي الرفيع بالمدرس الرسمية للغات والخاصة":{"studentCount":3,"totalMarks":50,"averageScore":44.33,"averagePercentage":88.7,"distribution":{"below50":0,"from50to65":0,"from65to75":0,"from75to85":1,"from85to100":2,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":0.0,"from75to85Percentage":33.3,"from85to100Percentage":66.7}},"اللغه الاجنبية الثانية  المستوي الرفيع بالمدرس الرسمية للغات والخاصة":{"studentCount":3,"totalMarks":40,"averageScore":28.33,"averagePercentage":70.8,"distribution":{"below50":0,"from50to65":0,"from65to75":3,"from75to85":0,"from85to100":0,"below50Percentage":0.0,"from50to65Percentage":0.0,"from65to75Percentage":100.0,"from75to85Percentage":0.0,"from85to100Percentage":0.0}}},"averageOverall":84.0};

// تجميع البيانات في كائن واحد
const analysisData = {
    "third": thirdGrade,
    "fourth": fourthGrade,
    "fifth": fifthGrade,
    "sixth": sixthGrade,
    "first_prep": firstPrepGrade,
    "second_prep": secondPrepGrade
};

// Grade Configuration
const gradeConfig = {
    third: {
        name: 'الصف الثالث الابتدائي',
        sheetName: 'الثالث',
        subjects: [
            { name: 'اللغة العربية', icon: '<i class="fas fa-book-open"></i>', examCol: 11, totalMarks: 60 },
            { name: 'الرياضيات', icon: '<i class="fas fa-calculator"></i>', examCol: 22, totalMarks: 60 },
            { name: 'اللغة الإنجليزية - CONNECT', icon: '<i class="fas fa-globe"></i>', examCol: 33, totalMarks: 60 },
            { name: 'التربية الدينية', icon: '<i class="fas fa-mosque"></i>', examCol: 45, totalMarks: 60 },
            { name: 'CONNECT PLUS (اللغات)', icon: '<i class="fas fa-language"></i>', examCol: 68, totalMarks: 60 }
        ]
    },
    fourth: {
        name: 'الصف الرابع الابتدائي',
        sheetName: 'الرابع',
        subjects: [
            { name: 'اللغة العربية', icon: '<i class="fas fa-book-open"></i>', examCol: 11, totalMarks: 60 },
            { name: 'الرياضيات', icon: '<i class="fas fa-calculator"></i>', examCol: 22, totalMarks: 60 },
            { name: 'اللغة الإنجليزية - CONNECT', icon: '<i class="fas fa-globe"></i>', examCol: 33, totalMarks: 60 },
            { name: 'التربية الدينية', icon: '<i class="fas fa-mosque"></i>', examCol: 45, totalMarks: 60 },
            { name: 'CONNECT PLUS (اللغات)', icon: '<i class="fas fa-language"></i>', examCol: 68, totalMarks: 60 }
        ]
    },
    fifth: {
        name: 'الصف الخامس الابتدائي',
        sheetName: 'الخامس',
        subjects: [
            { name: 'اللغة العربية', icon: '<i class="fas fa-book-open"></i>', examCol: 11, totalMarks: 60 },
            { name: 'الرياضيات', icon: '<i class="fas fa-calculator"></i>', examCol: 22, totalMarks: 60 },
            { name: 'اللغة الإنجليزية - CONNECT', icon: '<i class="fas fa-globe"></i>', examCol: 33, totalMarks: 60 },
            { name: 'التربية الدينية', icon: '<i class="fas fa-mosque"></i>', examCol: 45, totalMarks: 60 },
            { name: 'CONNECT PLUS (اللغات)', icon: '<i class="fas fa-language"></i>', examCol: 68, totalMarks: 60 }
        ]
    },
    sixth: {
        name: 'الصف السادس الابتدائي',
        sheetName: 'السادس',
        subjects: [
            { name: 'اللغة العربية', icon: '<i class="fas fa-book-open"></i>', examCol: 11, totalMarks: 60 },
            { name: 'الرياضيات', icon: '<i class="fas fa-calculator"></i>', examCol: 22, totalMarks: 60 },
            { name: 'اللغة الإنجليزية - CONNECT', icon: '<i class="fas fa-globe"></i>', examCol: 33, totalMarks: 60 },
            { name: 'التربية الدينية', icon: '<i class="fas fa-mosque"></i>', examCol: 45, totalMarks: 60 },
            { name: 'CONNECT PLUS (اللغات)', icon: '<i class="fas fa-language"></i>', examCol: 68, totalMarks: 60 }
        ]
    },
    first_prep: {
        name: 'الصف الأول الإعدادي',
        sheetName: '1ع',
        subjects: [
            { name: 'اللغة العربية', icon: '<i class="fas fa-book-open"></i>', examCol: 11, totalMarks: 60 },
            { name: 'الرياضيات', icon: '<i class="fas fa-calculator"></i>', examCol: 22, totalMarks: 60 },
            { name: 'اللغة الإنجليزية', icon: '<i class="fas fa-globe"></i>', examCol: 33, totalMarks: 60 },
            { name: 'العلوم', icon: '<i class="fas fa-flask"></i>', examCol: 45, totalMarks: 60 },
            { name: 'الدراسات الاجتماعية', icon: '<i class="fas fa-map-marked-alt"></i>', examCol: 56, totalMarks: 60 }
        ]
    },
    second_prep: {
        name: 'الصف الثاني الإعدادي',
        sheetName: '2ع',
        subjects: [
            { name: 'اللغة العربية', icon: '<i class="fas fa-book-open"></i>', examCol: 11, totalMarks: 60 },
            { name: 'الرياضيات', icon: '<i class="fas fa-calculator"></i>', examCol: 22, totalMarks: 60 },
            { name: 'اللغة الإنجليزية', icon: '<i class="fas fa-globe"></i>', examCol: 33, totalMarks: 60 },
            { name: 'العلوم', icon: '<i class="fas fa-flask"></i>', examCol: 45, totalMarks: 60 },
            { name: 'الدراسات الاجتماعية', icon: '<i class="fas fa-map-marked-alt"></i>', examCol: 56, totalMarks: 60 }
        ]
    }
};

// Current active grade
let currentGrade = 'summary';

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    setupTabListeners();
    loadAnalysisData();
});

// Setup tab listeners
function setupTabListeners() {
    const tabButtons = document.querySelectorAll('.tab-button');
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const grade = button.getAttribute('data-grade');
            switchTab(grade);
        });
    });
}

// Switch tab
function switchTab(grade) {
    // Update active button
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`[data-grade="${grade}"]`).classList.add('active');

    currentGrade = grade;
    displayGradeData(grade);
}

// Load analysis data
function loadAnalysisData() {
    document.getElementById('loading').style.display = 'none';
    displayGradeData(currentGrade);
}

// Display grade data
function displayGradeData(grade) {
    const tabContent = document.getElementById('tabContent');
    
    // Check if it's summary view
    if (grade === 'summary') {
        displaySummaryView();
        return;
    }
    
    const gradeData = analysisData[grade];
    
    if (!gradeData) {
        tabContent.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">لا توجد بيانات متاحة لهذا الصف</p>';
        return;
    }

    const config = gradeConfig[grade];
    
    // Create summary section
    let html = `
        <div class="summary">
            <h2>${config.name}</h2>
            <div class="summary-stats">
                <div class="summary-stat">
                    <div class="summary-stat-value">${gradeData.totalStudents || 0}</div>
                    <div class="summary-stat-label">إجمالي الطلاب</div>
                </div>
                <div class="summary-stat">
                    <div class="summary-stat-value">${gradeData.averageOverall || 0}%</div>
                    <div class="summary-stat-label">المتوسط العام</div>
                </div>
                <div class="summary-stat">
                    <div class="summary-stat-value">${Object.keys(gradeData.subjects || {}).length}</div>
                    <div class="summary-stat-label">عدد المواد</div>
                </div>
            </div>
        </div>
    `;

    // Create subjects grid
    html += '<div class="subjects-grid">';
    
    if (gradeData.subjects) {
        Object.entries(gradeData.subjects).forEach(([subjectName, subjectData]) => {
            html += createSubjectCard(subjectName, subjectData);
        });
    }
    
    html += '</div>';
    
    tabContent.innerHTML = html;
    
    // Animate bars
    setTimeout(() => {
        document.querySelectorAll('.distribution-bar').forEach(bar => {
            bar.style.width = bar.getAttribute('data-width');
        });
    }, 100);
}

// Create subject card
function createSubjectCard(name, data) {
    const icon = getSubjectIcon(name);
    
    return `
        <div class="subject-card">
            <div class="subject-header">
                <span class="subject-icon">${icon}</span>
                <span class="subject-name">${name}</span>
            </div>
            
            <div class="subject-stats">
                <div class="stat-item">
                    <div class="stat-label">عدد الطلاب</div>
                    <div class="stat-value">${data.studentCount || 0}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">متوسط النسبة</div>
                    <div class="stat-value">${data.averagePercentage?.toFixed(1) || 0}%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">أعلى درجة</div>
                    <div class="stat-value">${data.maxScore || 0}</div>
                    <div class="stat-secondary">من ${data.totalMarks || 0}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">أقل درجة</div>
                    <div class="stat-value">${data.minScore || 0}</div>
                    <div class="stat-secondary">من ${data.totalMarks || 0}</div>
                </div>
            </div>
            
            <div class="distribution">
                <div class="distribution-title"><i class="fas fa-chart-bar"></i> توزيع الطلاب حسب النسب المئوية:</div>
                ${createDistributionBars(data.distribution)}
            </div>
        </div>
    `;
}

// Create distribution bars
function createDistributionBars(distribution) {
    if (!distribution) return '';
    
    const categories = [
        { key: 'below50', label: 'أقل من 50%', colorClass: 'bar-color-1' },
        { key: 'from50to65', label: 'من 50% لأقل من 65%', colorClass: 'bar-color-2' },
        { key: 'from65to75', label: 'من 65% لأقل من 75%', colorClass: 'bar-color-3' },
        { key: 'from75to85', label: 'من 75% لأقل من 85%', colorClass: 'bar-color-4' },
        { key: 'from85to100', label: 'من 85% إلى 100%', colorClass: 'bar-color-5' }
    ];
    
    let html = '';
    categories.forEach(category => {
        const count = distribution[category.key] || 0;
        const percentage = distribution[`${category.key}Percentage`] || 0;
        
        html += `
            <div class="distribution-item">
                <div class="distribution-label">
                    <span>${category.label}</span>
                    <span><strong>${count}</strong> طالب (${percentage.toFixed(1)}%)</span>
                </div>
                <div class="distribution-bar-container">
                    <div class="distribution-bar ${category.colorClass}" 
                         style="width: 0%" 
                         data-width="${percentage}%">
                        ${percentage > 5 ? percentage.toFixed(0) + '%' : ''}
                    </div>
                </div>
            </div>
        `;
    });
    
    return html;
}

// Get subject icon
function getSubjectIcon(subjectName) {
    const icons = {
        'اللغة العربية': '<i class="fas fa-book-open"></i>',
        'اللغة العربية والخط': '<i class="fas fa-pen-fancy"></i>',
        'اللغة الاجنبية': '<i class="fas fa-globe"></i>',
        'الرياضيات': '<i class="fas fa-calculator"></i>',
        'اللغة الإنجليزية - CONNECT': '<i class="fas fa-globe"></i>',
        'اللغة الإنجليزية': '<i class="fas fa-globe"></i>',
        'التربية الدينية': '<i class="fas fa-mosque"></i>',
        'CONNECT PLUS (اللغات)': '<i class="fas fa-language"></i>',
        'العلوم': '<i class="fas fa-flask"></i>',
        'الدراسات الاجتماعية': '<i class="fas fa-map-marked-alt"></i>',
        'الدرسات الاجتماعية': '<i class="fas fa-map-marked-alt"></i>',
        'تكنولوجيا المعلومات والإتصال': '<i class="fas fa-laptop-code"></i>',
        'الكمبيوتر وتكنولوجيا المعلومات': '<i class="fas fa-laptop-code"></i>',
        'المستوى الرفيع (مدارس اللغات)': '<i class="fas fa-star"></i>',
        'المستوى الرفيع 1 (مدارس اللغات)': '<i class="fas fa-star"></i>',
        'المستوى الرفيع 2 (مدارس اللغات)': '<i class="fas fa-certificate"></i>',
        'المستوي الرفيع 1': '<i class="fas fa-star"></i>',
        'المستوي الرفيع 2': '<i class="fas fa-certificate"></i>',
        'اللغه الاجنبية الاولي المستوي الرفيع بالمدرس الرسمية للغات والخاصة': '<i class="fas fa-star"></i>',
        'اللغه الاجنبية الثانية  المستوي الرفيع بالمدرس الرسمية للغات والخاصة': '<i class="fas fa-certificate"></i>',
        'اللغة الفرنسية (قسم اللغات)': '<i class="fas fa-flag"></i>'
    };
    
    return icons[subjectName] || '<i class="fas fa-book"></i>';
}

// Display summary view for all grades
function displaySummaryView() {
    const tabContent = document.getElementById('tabContent');
    
    let html = `
        <div class="summary">
            <h2><i class="fas fa-clipboard-list"></i> الملخص الشامل لجميع الصفوف</h2>
        </div>
        <div class="summary-table-container">
            <table class="summary-table">
                <thead>
                    <tr>
                        <th>الصف</th>
                        <th>عدد الطلاب</th>
                        <th>المتوسط العام</th>
                        <th>أعلى مادة</th>
                        <th>أدنى مادة</th>
                    </tr>
                </thead>
                <tbody>
    `;
    
    // Loop through all grades
    const grades = ['third', 'fourth', 'fifth', 'sixth', 'first_prep', 'second_prep'];
    
    grades.forEach(gradeKey => {
        const gradeData = analysisData[gradeKey];
        const config = gradeConfig[gradeKey];
        
        if (!gradeData || !config) return;
        
        // Find highest and lowest subjects
        let highestSubject = { name: '-', percentage: 0 };
        let lowestSubject = { name: '-', percentage: 100 };
        
        if (gradeData.subjects) {
            Object.entries(gradeData.subjects).forEach(([name, data]) => {
                const percentage = data.averagePercentage || 0;
                if (percentage > highestSubject.percentage) {
                    highestSubject = { name, percentage };
                }
                if (percentage < lowestSubject.percentage && percentage > 0) {
                    lowestSubject = { name, percentage };
                }
            });
        }
        
        html += `
            <tr onclick="switchTab('${gradeKey}')" style="cursor: pointer;">
                <td><strong>${config.name}</strong></td>
                <td>${gradeData.totalStudents || 0}</td>
                <td><span class="badge badge-primary">${gradeData.averageOverall || 0}%</span></td>
                <td>
                    <div class="subject-mini">
                        <span>${highestSubject.name}</span>
                        <span class="badge badge-success">${highestSubject.percentage.toFixed(1)}%</span>
                    </div>
                </td>
                <td>
                    <div class="subject-mini">
                        <span>${lowestSubject.name}</span>
                        <span class="badge badge-warning">${lowestSubject.percentage.toFixed(1)}%</span>
                    </div>
                </td>
            </tr>
        `;
    });
    
    html += `
                </tbody>
            </table>
        </div>
        
        <div class="summary-cards">
            <div class="summary-info-card">
                <i class="fas fa-users"></i>
                <div class="summary-info-content">
                    <h3>${Object.values(analysisData).reduce((sum, grade) => sum + (grade.totalStudents || 0), 0)}</h3>
                    <p>إجمالي الطلاب</p>
                </div>
            </div>
            <div class="summary-info-card">
                <i class="fas fa-book"></i>
                <div class="summary-info-content">
                    <h3>${grades.length}</h3>
                    <p>عدد الصفوف</p>
                </div>
            </div>
            <div class="summary-info-card">
                <i class="fas fa-chart-bar"></i>
                <div class="summary-info-content">
                    <h3>${(Object.values(analysisData).reduce((sum, grade) => sum + (grade.averageOverall || 0), 0) / grades.length).toFixed(1)}%</h3>
                    <p>المتوسط الكلي</p>
                </div>
            </div>
        </div>
    `;
    
    tabContent.innerHTML = html;
}
